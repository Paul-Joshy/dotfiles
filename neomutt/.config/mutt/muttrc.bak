# Neomutt configuration with Gmail App Password
# Vim-style navigation + Catppuccin aesthetic

##################
# Account Settings
##################

set realname = "Paul Joshy"
set from = "pauljoshyk96@gmail.com"
set use_from = yes
set envelope_from = yes

#####################
# Maildir + Mailboxes
#####################

set folder = "~/.mail/gmail"
set spoolfile = "+INBOX"
set postponed = "+Drafts"
set record = "+Sent"
set trash = "+Trash"

mailboxes +INBOX +Drafts +Sent +Trash

#################
# Sending Mail
#################

set sendmail = "/usr/bin/msmtp"
set sendmail_wait = 0
set use_ipv6 = no

######################
# GPG / PGP Encryption
######################

set crypt_use_gpgme = yes
set pgp_default_key = "pauljoshyk96@gmail.com"
set pgp_sign_as = "pauljoshyk96@gmail.com"
set pgp_autosign = yes
set pgp_replysign = yes
set pgp_replyencrypt = yes
set pgp_verify_sig = yes
set pgp_use_gpg_agent = yes
set pgp_auto_decode = yes

####################
# Interface Settings
####################

set menu_scroll = yes
set smart_wrap = yes
set markers = yes
set pager_stop = yes
set pager_context = 3
set pager_index_lines = 10
set index_format = "%4C %Z %{%b %d} %-15.15L (%4l) %s"
set sort = reverse-date-sent
set sort_aux = last-date
set sort_re = yes

set charset = "utf-8"
set send_charset = "utf-8"
set assumed_charset = "utf-8"

set editor = "nvim"

##############
# Sidebar
##############

set sidebar_visible = yes
set sidebar_width = 20
set sidebar_indent_string = "  "
# Not all builds support this; comment if it errors
#set sidebar_delim = "│"

##################
# Vim-Like Binds
##################

# Navigation in index and pager
bind index,pager j next-entry
bind index,pager k previous-entry
bind index,pager h previous-folder
bind index,pager l view-message
bind index,pager <down> next-entry
bind index,pager <up> previous-entry

# Jump to first/last mail
bind index gg first-entry
bind index G last-entry

# Vim search keys
bind index / search
bind index ? search-reverse
bind index n search-next
bind index N search-opposite

# Message operations
bind index,pager dd delete-message
bind index,pager u undelete-message
bind index,pager r reply
bind index,pager R group-reply
bind index,pager f forward-message
bind index,pager m compose
bind index,pager s save-message
bind index,pager v view-attachments
bind index,pager o view-message
bind index,pager <enter> view-message

# Move between unread
bind index,pager w next-unread
bind index,pager b previous-unread

# Sidebar navigation
bind index,pager <left> sidebar-prev
bind index,pager <right> sidebar-next
bind index,pager <space> sidebar-toggle

# Sync mail
bind index <F5> sync-mailbox
macro index <F6> "<shell-escape>mbsync gmail<enter>"

# gg for first entry (workaround)
macro index gg "<first-entry>"

##################
# Colors - Catppuccin
##################

# Base UI
color normal         default        default
color status         black          magenta
color indicator      magenta        black
color error          brightred      default
color message        brightcyan     default
color markers        brightmagenta  default

# Mail state (Catppuccin Mocha-ish palette)
color index          color81        default     "~N"   # Unread (Teal/Cyan)
color index          brightgreen    default     "~F"   # Flagged
color index          color135       default     "~P"   # Passed
color index          brightred      default     "~D"   # Deleted
color index          color38        default     "~R"   # Replied
color index          white          default     "~S"   # Signed
color index          brightyellow   default     "~O"   # Old
color index          color208       default     "~T"   # Tagged (Orange)
color index          color117       default     "~Q"   # Queued
color index          color141       default     "~A"   # Answered
color index          color33        default     "~b"   # Mailboxes with new mail



######################
# Folder Hooks + Sync
######################

folder-hook . 'set sort=date-sent'
folder-hook INBOX 'set sort=date-sent'

macro index <F5> "<sync-mailbox><enter>"

##################
# Notmuch (optional)
##################

set nm_default_uri = "notmuch:///home/paul/.mail/gmail"
set virtual_spoolfile = yes


# macros
macro index <enter> "<first-entry><enter>" "Open newest message"
folder-hook . 'push <next-unread>'

# Star/unstar (flag/unflag) message with *
bind index * flag
bind pager * flag

bind index v tag-entry
bind index V tag-pattern
bind index ; tag-prefix

# Use 'v' to start tagging messages
bind index v tag-entry         # Toggle tag on current message

# Use 'j' and 'k' to navigate while tagging
bind index j next-entry
bind index k previous-entry

# ; prefix for applying commands to tagged
bind index ; tag-prefix

# Bulk delete tagged messages with 'd'
macro index d ";d" "Delete all tagged messages"

# Mark all tagged as read with 'r'
macro index r ";<flag-message>" "Mark tagged messages as read"

# Optional: clear all tags with 'u'
macro index u ";<clear-flag>" "Untag all"

# Space to tag/untag message
bind index <space> tag-entry

# Enter to view full message
bind index <enter> view-attach  # default 'view-message'

# ZZ to mark read and exit pager
macro pager ZZ "<tag-entry><read-message><exit>" "Mark as read and quit pager"

# ZQ to mark read and exit pager
macro pager ZQ "<tag-entry><read-message><exit>" "Mark as read and quit pager"

# Optional: highlight tagged
color index brightyellow default "~T"

# Unread messages
color index color81 default "~N"

# Tagged messages — moved below others so it's not overridden
color index color208 default "~T"

